<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vorliyo - உள்நுழைய/பதிவு செய்ய</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-md p-6 sm:p-8 space-y-6 bg-white rounded-xl shadow-2xl border-t-4 border-indigo-500 mx-4">
        <h1 class="text-3xl font-extrabold text-indigo-600 text-center">Vorliyo</h1>
        <h2 class="text-2xl font-bold text-gray-900 text-center" id="authTitle">உள்நுழைக</h2>

        <form id="authForm" class="space-y-4">
            
            <div id="userTypeSelector" class="hidden">
                 <label for="userType" class="block text-sm font-medium text-gray-700">நீங்கள் யார்?</label>
                 <select id="userType" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                     <option value="" disabled selected>ஒரு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                     <option value="client">வாடிக்கையாளர் (வேலைக்கு ஆள் தேடுபவர்)</option>
                     <option value="freelancer">ஃப்ரீலான்சர் (வேலை தேடுபவர்)</option>
                 </select>
            </div>
            
             <div id="nameField" class="hidden">
                 <label for="userName" class="block text-sm font-medium text-gray-700">உங்கள் பெயர்</label>
                 <input id="userName" type="text" placeholder="உங்கள் முழுப் பெயர்" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg">
            </div>

            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">மின்னஞ்சல் முகவரி</label>
                <input id="email" type="email" placeholder="example@gmail.com" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">கடவுச்சொல்</label>
                <input id="password" type="password" placeholder="குறைந்தது 6 எழுத்து" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <p id="messageBox" class="text-sm font-medium text-center text-red-600 h-5"></p>

            <button type="submit" id="authButton" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150">
                உள்நுழைய
            </button>
        </form>

        <div class="text-center pt-2">
            <button onclick="toggleAuthMode()" id="switchAuthMode" class="text-indigo-600 hover:text-indigo-800 font-medium">
                கணக்கு இல்லையா? பதிவு செய்யவும்
            </button>
            <p class="mt-3">
                <a href="user-index.html" class="text-gray-500 hover:text-gray-700 text-sm">முகப்புப் பக்கத்திற்குத் திரும்பவும்</a>
            </p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Config (Please make sure this is your config!)
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDD755-oGyx0hwrLykhF7m2k1uWFnLFMDQ",
            authDomain: "vorliyo.firebaseapp.com",
            projectId: "vorliyo",
            storageBucket: "vorliyo.firebasestorage.app",
            messagingSenderId: "480604417883",
            appId: "1:480604417883:web:5b4926a2a1b21f3ae2747e",
        };
        
        const firebaseConfig = FIREBASE_CONFIG;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'vorliyo-default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let isLoginMode = true;

        // Check if user is already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('messageBox').textContent = 'நீங்கள் ஏற்கனவே உள்நுழைந்துள்ளீர்கள். டாஷ்போர்டுக்குச் செல்கிறது...';
                document.getElementById('messageBox').classList.remove('text-red-600');
                document.getElementById('messageBox').classList.add('text-green-600');
                // FIX: Added './' for reliable path resolution
                setTimeout(() => { window.location.href = './user-dashboard.html'; }, 1500);
            }
        });

        // --- AUTH MODE TOGGLE ---
        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'உள்நுழைக' : 'புதிய கணக்கைப் பதிவு செய்க';
            document.getElementById('authButton').textContent = isLoginMode ? 'உள்நுழைய' : 'பதிவு செய்ய';
            document.getElementById('switchAuthMode').textContent = isLoginMode ? 'கணக்கு இல்லையா? பதிவு செய்யவும்' : 'ஏற்கனவே கணக்கு உள்ளதா? உள்நுழைக';
            
            // Toggle signup specific fields
            const visibility = isLoginMode ? 'hidden' : 'block';
            document.getElementById('userTypeSelector').classList.remove(isLoginMode ? 'block' : 'hidden');
            document.getElementById('userTypeSelector').classList.add(visibility);
            document.getElementById('nameField').classList.remove(isLoginMode ? 'block' : 'hidden');
            document.getElementById('nameField').classList.add(visibility);
            
            document.getElementById('authForm').reset();
            document.getElementById('messageBox').textContent = '';
        }

        // --- FORM SUBMISSION ---
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msgBox = document.getElementById('messageBox');
            msgBox.textContent = 'செயல்படுத்துகிறது...';
            msgBox.classList.remove('text-green-600');
            msgBox.classList.add('text-red-600');

            if (isLoginMode) {
                // --- LOGIN ---
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    msgBox.textContent = 'வெற்றிகரமாக உள்நுழைந்தது! டாஷ்போர்டுக்குச் செல்கிறது...';
                    msgBox.classList.remove('text-red-600');
                    msgBox.classList.add('text-green-600');
                    // FIX: Added './' for reliable path resolution
                    setTimeout(() => { window.location.href = './user-dashboard.html'; }, 1000);
                } catch (error) {
                    console.error("Login Error:", error);
                    msgBox.textContent = 'உள்நுழைவு தோல்வியடைந்தது. மின்னஞ்சல்/கடவுச்சொல்லைச் சரிபார்க்கவும்.';
                }
            } else {
                // --- SIGNUP ---
                const userType = document.getElementById('userType').value;
                const userName = document.getElementById('userName').value;

                if (!userType || !userName) {
                    msgBox.textContent = 'பதிவு செய்ய பெயர் மற்றும் பயனர் வகையைத் தேர்ந்தெடுக்கவும்.';
                    return;
                }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    // FIX: Ensure correct profile path is used to prevent "Profile document not found" error
                    // Firestore Profile Creation Path: artifacts/{appId}/users/{uid}/profile/{uid}
                    const profileDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile', user.uid);
                    await setDoc(profileDocRef, {
                        uid: user.uid,
                        email: email,
                        name: userName,
                        userType: userType, // 'client' or 'freelancer'
                        isFreelancer: userType === 'freelancer',
                        isVerified: false,
                        tagline: '',
                        about: '',
                        createdAt: new Date(),
                    });

                    msgBox.textContent = 'பதிவு வெற்றிகரமாக முடிந்தது! டாஷ்போர்டுக்குச் செல்கிறது...';
                    msgBox.classList.remove('text-red-600');
                    msgBox.classList.add('text-green-600');
                    // FIX: Added './' for reliable path resolution
                    setTimeout(() => { window.location.href = './user-dashboard.html'; }, 1000);
                } catch (error) {
                    console.error("Signup Error:", error);
                    msgBox.textContent = 'பதிவு தோல்வியடைந்தது. மின்னஞ்சல் ஏற்கெனவே இருக்கலாம் அல்லது கடவுச்சொல் பலவீனமாக இருக்கலாம்.';
                }
            }
        });
        
    </script>
</body>
</html>
```eof
